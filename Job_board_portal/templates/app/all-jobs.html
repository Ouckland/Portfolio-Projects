{% extends "partials/base.html" %}
{% load static %}
{% load custom_filters %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/all-jobs.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock head %}

{% block content %}
  {% include "partials/header.html" %}
<div class="job-search-container {% if profile_type == 'seeker' %}seeker-mode{% endif %}">
  <!-- Search Form -->
  <form method="get" class="search-filters">
    <div class="search-bar">
      <input type="text" name="q" placeholder="Search jobs..." value="{{ search_query }}">
      <button type="submit">
        <i class="fas fa-search"></i> Search
      </button>
    </div>
    
    <div class="filter-row">
      <div class="filter-group">
        <label>Location</label>
        <input type="text" name="location" placeholder="Any location" value="{{ location }}">
      </div>
      
      <div class="filter-group">
        <label>Job Type</label>
        <select name="type">
          <option value="">All Types</option>
          {% for value, label in job_types %}
            <option value="{{ value }}" {% if job_type == value %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </div>
      
      <div class="filter-group">
        <label>Salary Range</label>
        <div class="salary-range">
          <input type="number" name="salary_min" placeholder="Min" value="{{ salary_min }}">
          <span>to</span>
          <input type="number" name="salary_max" placeholder="Max" value="{{ salary_max }}">
        </div>
      </div>
    </div>
  </form>

  <!-- Results Count -->
  <div class="results-count">
    {% if profile_type == 'employer' %}
      Total of {{ jobs.paginator.count }} jobs Posted
    {% else %}
      Found {{ jobs.paginator.count }} matching jobs
    {% endif %}
    {% if search_query or location or job_type or salary_min or salary_max %}
      <a href="{% url 'jobs:all_jobs' %}" class="clear-filters">
        <i class="fas fa-times"></i> Clear filters
      </a>
    {% endif %}
  </div>

  <!-- Recommended Jobs (Seeker Only) -->
  {% if profile_type == 'seeker' and recommended_jobs %}
  <div class="recommended-section">
    <h3><i class="fas fa-lightbulb"></i> Recommended For You</h3>
    <div class="recommended-jobs">
      {% for job in recommended_jobs %}
      <div class="recommended-job">
        <div class="recommended-job-content">
          <h4>{{ job.title }}</h4>
          <div class="recommended-meta">
            <span>{{ job.employer.company_name }}</span>
            <span>{{ job.location }}</span>
            {% if job.match_score %}
            <span class="match-score">{{ job.match_score }}% match</span>
            {% endif %}
          </div>
        </div>
        <a href="{% url 'jobs:view_job_detail' job.id %}" class="view-btn">
          View <i class="fas fa-chevron-right"></i>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Jobs List -->
  <div class="jobs-list">
    {% for job in jobs %}
    <div class="job-card {% if profile_type == 'seeker' %}seeker-job{% endif %}">
      <div class="job-header">
        <div class="job-title-wrap">
          <h3>{{ job.title }}</h3>
          <div class="job-meta">
            <span class="job-type">{{ job.get_job_type_display }}</span>
            {% if profile_type == 'employer' %}
              <span class="job-status {{ job.job_status|lower }}">{{ job.job_status }}</span>
            {% else %}
              <span class="job-deadline"><i class="far fa-clock"></i> Apply by {{ job.deadline|date:"M d" }}</span>
            {% endif %}
          </div>
        </div>
        <div class="job-actions">
          {% if profile_type == 'employer' %}
            <a href="{% url 'jobs:view_job_detail' job.id %}" class="action-btn view" title="View">
              <i class="fas fa-eye"></i>
            </a>
            <a href="{% url 'jobs:update_job_details' job.id %}" class="action-btn edit" title="Edit">
              <i class="fas fa-edit"></i>
            </a>
            <a href="{% url 'jobs:delete_job' job.id %}" class="action-btn delete" title="Delete">
              <i class="fas fa-trash-alt"></i>
            </a>
          {% else %}
             <div class="seeker-action-buttons">
            <a href="{% url 'jobs:view_job_detail' job.id %}" class="action-btn view-details" title='View'>
              <i class="fas fa-search-plus"></i>
            </a>
            <a href="{% url 'jobs:apply_for_job' job.id %}" class="action-btn primary-action" title='Apply'>
              <i class="fas fa-paper-plane"></i>
            </a>
            
          </div>
        {% endif %}
        </div>
      </div>
      
      <div class="job-details">
        <div class="job-company">
          {% if job.employer.company_logo %}
          <a href="{% url 'users:public_profile' job.employer.user.username %}"><img src="{{ job.employer.company_logo.url }}" alt="{{ job.employer.company_name }}" class="company-logo"></a>
          {% endif %}
          <span><i class="fas fa-building"></i> {{ job.employer.company_name }}</span>
          <span><i class="fas fa-map-marker-alt"></i> {{ job.location }}</span>
        </div>
        
        <div class="job-salary">
          <i class="fas fa-money-bill-wave"></i>
          {% if job.salary %}
            ${{ job.salary|floatformat:"0" }} per year
          {% else %}
            Salary not specified
          {% endif %}
        </div>
      </div>
      
      <div class="job-description">
        {{ job.description|truncatewords:30 }}
      </div>
      
      {% if profile_type == 'seeker' %}
      <div class="job-skills">
        {% for skill in job.skills_required|display_skills %}
          <span class="skill-tag">{{ skill }}</span>
        {% endfor %}
      </div>
      {% endif %}
      
      <div class="job-footer">
        <span class="post-date"><i class="far fa-clock"></i> Posted {{ job.posted_date|timesince }} ago</span>
        <div class="footer-actions" style='display: flex; gap: 10px;'>
          <a href="{% url 'jobs:view_job_detail' job.id %}" class="view-btn">
            View Details <i class="fas fa-chevron-right"></i>
          </a>
          {% if job.id in saved_job_ids %}
              {% include "partials/unsave-job.html" %}
            {% else %}
            {% include "partials/save-job.html" %}
            {% endif %}
        </div>
      </div>
    </div>
    {% empty %}
    <div class="no-results">
      <i class="fas fa-briefcase"></i>
      <h3>No jobs found</h3>
      <p>
        {% if profile_type == 'employer' %}
          You have not posted any jobs
          <a href="{% url 'jobs:add_job' %}" class='clear-filters'>Post a job</a>
        {% else %}
          No jobs match your search criteria
        {% endif %}
      </p>
      <a href="{% url 'jobs:all_jobs' %}" class="clear-filters">Clear all filters</a>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if jobs.has_other_pages %}
  <div class="pagination">
    {% if jobs.has_previous %}
      <a href="?page={{ jobs.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if job_type %}&type={{ job_type }}{% endif %}{% if salary_min %}&salary_min={{ salary_min }}{% endif %}{% if salary_max %}&salary_max={{ salary_max }}{% endif %}" class="page-link">
        <i class="fas fa-chevron-left"></i> Previous
      </a>
    {% endif %}
    
    <div class="page-numbers">
      {% for num in jobs.paginator.page_range %}
        {% if jobs.number == num %}
          <span class="current">{{ num }}</span>
        {% else %}
          <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if job_type %}&type={{ job_type }}{% endif %}{% if salary_min %}&salary_min={{ salary_min }}{% endif %}{% if salary_max %}&salary_max={{ salary_max }}{% endif %}" class="page-link">
            {{ num }}
          </a>
        {% endif %}
      {% endfor %}
    </div>
    
    {% if jobs.has_next %}
      <a href="?page={{ jobs.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if job_type %}&type={{ job_type }}{% endif %}{% if salary_min %}&salary_min={{ salary_min }}{% endif %}{% if salary_max %}&salary_max={{ salary_max }}{% endif %}" class="page-link">
        Next <i class="fas fa-chevron-right"></i>
      </a>
    {% endif %}
  </div>
  {% endif %}
</div>

<style>
 
</style>
{% endblock %}




