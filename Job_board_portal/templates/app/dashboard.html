{% extends "partials/base.html" %}
{% block content %}
    {% include "partials/header.html" %}

    <div style="max-width: 1000px; margin: auto; padding: 2rem;">
        <h2 style="margin-bottom: 1.5rem;">
            Welcome, {{ request.user.get_full_name|default:request.user.username }}
        </h2>

        {% if user.employerprofile %}
            <!-- Employer Dashboard -->
            <section style="margin-bottom: 3rem;">
                <h3 style="margin-bottom: 1rem;">Your Active Jobs</h3>
                <ul style="list-style: none; padding: 0;">
                    {% for job in active_jobs %}
                        <li style="padding: 1rem; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 1rem;">
                            <strong style="font-size: 1.1rem;">{{ job.title }}</strong><br>
                            <small>Applications: {{ job.applications.count }}</small><br>
                            <a href="{% url 'jobs:view_job_detail' job.id %}" style="margin-right: 1rem;">View Job Detail</a>
                            <a href="{% url 'jobs:view_applications' job.id %}">View All Applications</a>
                        </li>
                    {% empty %}
                        <li>No active jobs found.</li>
                    {% endfor %}
                </ul>

                <div style="margin-top: 1.5rem;">
                    <a href="{% url 'jobs:add_job' %}" style="padding: 0.6rem 1.2rem; background: #007bff; color: white; border-radius: 4px; text-decoration: none;">Post a New Job</a>
                </div>
            </section>

        {% elif user.seekerprofile %}
            <!-- Seeker Dashboard -->
            <section style="margin-bottom: 3rem;">
                <h3 style="margin-bottom: 1rem;">Recommended Jobs</h3>

                <!-- Filters -->
                <form method="get" style="margin-bottom: 1.5rem; display: flex; flex-wrap: wrap; gap: 0.8rem;">
                    <input type="text" name="q" placeholder="Search jobs..." value="{{ request.GET.q }}" style="padding: 0.4rem; flex: 1;">
                    
                    <select name="job_type" style="padding: 0.4rem;">
                        <option value="">Job Type</option>
                        <option value="remote" {% if request.GET.job_type == 'remote' %}selected{% endif %}>Remote</option>
                        <option value="onsite" {% if request.GET.job_type == 'onsite' %}selected{% endif %}>Onsite</option>
                        <option value="hybrid" {% if request.GET.job_type == 'hybrid' %}selected{% endif %}>Hybrid</option>
                    </select>

                    <input type="text" name="location" placeholder="Location" value="{{ request.GET.location }}" style="padding: 0.4rem;">

                    <select name="sort" style="padding: 0.4rem;">
                        <option value="">Sort By</option>
                        <option value="recent" {% if request.GET.sort == 'recent' %}selected{% endif %}>Newest</option>
                        <option value="deadline" {% if request.GET.sort == 'deadline' %}selected{% endif %}>Deadline</option>
                    </select>

                    <button type="submit" style="padding: 0.4rem 1rem; background: #28a745; color: white; border: none; border-radius: 4px;">Apply</button>
                </form>

                <!-- Job List -->
                <ul style="list-style: none; padding: 0;">
                    {% for job in latest_jobs %}
                        <li style="padding: 1rem; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 1rem;">
                            <strong style="font-size: 1.1rem;">{{ job.title }}</strong><br>
                            <small style="color: #555;">{{ job.employer.company_name }}</small><br>
                            <a href="{% url 'jobs:view_job_detail' job.id %}">View Job Detail</a>
                        </li>
                    {% empty %}
                        <li>No jobs available at the moment.</li>
                    {% endfor %}
                </ul>

                <!-- Pagination -->
                <div style="margin-top: 1.5rem;">
                    {% if latest_jobs.has_other_pages %}
                        <div style="display: flex; gap: 1rem;">
                            {% if latest_jobs.has_previous %}
                                <a href="?page={{ latest_jobs.previous_page_number }}" style="text-decoration: none;">← Previous</a>
                            {% endif %}

                            <span>Page {{ latest_jobs.number }} of {{ latest_jobs.paginator.num_pages }}</span>

                            {% if latest_jobs.has_next %}
                                <a href="?page={{ latest_jobs.next_page_number }}" style="text-decoration: none;">Next →</a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </section>

            <!-- Applications -->
            <section>
                <h3 style="margin-bottom: 1rem;">Your Applications</h3>
                <ul style="list-style: none; padding: 0;">
                    {% for application in job_applications %}
                        <li style="padding: 1rem; border: 1px solid #eee; border-radius: 6px; margin-bottom: 1rem;">
                            <strong>{{ application.job.title }}</strong> – Applied on {{ application.application_date|date:"F j, Y" }}<br>
                            <small>Status: {{ application.status|default:"Pending" }}</small><br>
                            <a href="{% url 'jobs:view_application_detail' application.id %}">View Application</a>
                        </li>
                    {% empty %}
                        <li>You haven’t applied for any jobs yet.</li>
                    {% endfor %}
                </ul>
            </section>
        {% else %}
            <p>Please complete your profile to see your dashboard.</p>
        {% endif %}
    </div>
{% endblock content %}
