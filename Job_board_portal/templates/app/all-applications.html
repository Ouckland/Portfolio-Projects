{% extends "partials/base.html" %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/all-jobs.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock head %}


{% block content %}
  {% include "partials/header.html" %}
<div class="job-search-container">
  <!-- Search Form -->
  <form method="get" class="search-filters">
    <div class="search-bar">
      <input type="text" name="q" placeholder="Type the job name..." value="{{ search_query }}">
      <button type="submit">
        <i class="fas fa-search"></i> Search
      </button>
    </div>
    
    <div class="filter-row">
      <div class="filter-group">
        <label>Applicant Name</label>
        <input type="text" name="applicant" placeholder="Any applicant" value="{{ applicant_name }}">
      </div>
      
      <div class="filter-group">
        <label>Status</label>
        <select name="status">
          <option value="">All Statuses</option>
          {% for value, label in status_choices %}
            <option value="{{ value }}" {% if status == value %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </div>
      
      <div class="filter-group">
        <label>Job Title</label>
        <input type="text" name="job_title" placeholder="Any job title" value="{{ job_title }}">
      </div>

      <div class="filter-group">
        <label>Application Date</label>
        <input type="date" name="application_date" value="{{ application_date }}">
      </div>
    </div>
  </form>

  <!-- Results Count -->
  <div class="results-count">
     Total of {{ applications.paginator.count }} applications
  </div>

  <!-- Applications List -->
  <div class="jobs-list">
    {% for application in applications %}
    <div class="job-card">
      <div class="job-header">
        <div class="job-title-wrap">
          <h3>{{ application.job.title }}</h3>
          <div class="job-meta">
            <span class="job-applicant">{{ application.applicant.full_name }}</span>
            <span class="application-status {{ application.status|lower }}">{{ application.get_status_display }}</span>
          </div>
        </div>
        
      </div>
      
      <div class="job-details">
        <div class="job-company">
          <span><i class="fas fa-user"></i> {{ application.applicant.user.email }}</span>
          <span><i class="fas fa-calendar-alt"></i> Applied {{ application.application_date|timesince }} ago</span>
        </div>
        
        <div class="job-salary">
          <i class="fas fa-file-alt"></i>
          {% if application.cover_letter %}
            {{ application.cover_letter|truncatewords:15 }}
          {% else %}
            No cover letter provided
          {% endif %}
        </div>
      </div>
      
      <div class="job-description">
        <p><strong>Skills:</strong> {{ application.applicant.skills|default:"Not specified" }}</p>
        <p><strong>Experience:</strong> {{ application.applicant.experience|default:"Not specified" }}</p>
      </div>
      
      <div class="job-footer">
        <span class="post-date"><i class="fas fa-download"></i> 
          <a href="{{ application.resume.url }}" download>Download Resume</a>
          {% if application.attachments %}
            | <a href="{{ application.attachments.url }}" download>Download Attachments</a>
          {% endif %}
        </span>
        <div class="footer-actions">
          <a href="{% url 'jobs:view_application_detail' application.id %}" class="view-btn">
            View Details <i class="fas fa-chevron-right"></i>
          </a>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="no-results">
      <i class="fas fa-file-alt"></i>
      <h3>No applications found</h3>
      <p>No one has applied to your jobs yet</p>
      <a href="{% url 'jobs:all_jobs' %}" class="clear-filters">View your job posts</a>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if applications.has_other_pages %}
  <div class="pagination">
    {% if applications.has_previous %}
      <a href="?page={{ applications.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if applicant_name %}&applicant={{ applicant_name }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if job_title %}&job_title={{ job_title }}{% endif %}{% if application_date %}&application_date={{ application_date }}{% endif %}" class="page-link">
        <i class="fas fa-chevron-left"></i> Previous
      </a>
    {% endif %}
    
    <div class="page-numbers">
      {% for num in applications.paginator.page_range %}
        {% if applications.number == num %}
          <span class="current">{{ num }}</span>
        {% else %}
          <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if applicant_name %}&applicant={{ applicant_name }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if job_title %}&job_title={{ job_title }}{% endif %}{% if application_date %}&application_date={{ application_date }}{% endif %}" class="page-link">
            {{ num }}
          </a>
        {% endif %}
      {% endfor %}
    </div>
    
    {% if applications.has_next %}
      <a href="?page={{ applications.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if applicant_name %}&applicant={{ applicant_name }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if job_title %}&job_title={{ job_title }}{% endif %}{% if application_date %}&application_date={{ application_date }}{% endif %}" class="page-link">
        Next <i class="fas fa-chevron-right"></i>
      </a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}